%!TEX root = ../report.tex
\section{Solution}
The paper introduced by van der Laan et al. \cite{van2009screen} provides a fitting solution to our problem.
The paper describes a method for visualizing fluids simulated using SPH in a natural way.
The goal of the paper is to provide a solution to our aforementioned problem.
According to the paper, they want to create:
\begin{enumerate}
	\item \label{en:item1} Achieves real-time performance, with a configurable speed versus quality trade-off.
	\item \label{en:item2} Does all the processing, rendering and shading steps directly on the graphics hardware.
	\item \label{en:item3} Smooths the surface to prevent the fluid from looking blobby or jelly-like.
	\item \label{en:item4} Is not based on polygonization, and thus does not suffer from the associated tessellation artifacts.
\end{enumerate}

Items \ref{en:item1} and \ref{en:item3} have a direct connection with our goals and items \ref{en:item2} and \ref{en:item4} are ways to enable these goals.

The method described in the paper consists of multiple passes. It assumes that there is a functional SPH simulation where each fluid particle has a density. Then each frame the following steps are performed:
\begin{enumerate}
	\item Splat points as spheres and determine depth values per fragment
	\item Smooth the spheres based on curvature flow
	\item Attenuate colors based on thickness
	\item Add noise texture and advect throughout the simulation
	\item Add foam
	\item Render using Fresnel and Phong equations
\end{enumerate}

\subsection{Depth determination}
It is desirable to determine depth of fragment in the simulation in order to know which fragments are part of the surface.

\subsection{Smoothing}

\subsection{Thickness}

\subsection{Noise}
In order to remove the appearance of an artificially smooth surface, noise has to be added.
Since the simulation has moving particles in it, the noise has to advect with those particles.
\cite{van2009screen} suggests to use Perlin noise \cite{perlin1985image}.
One octave of noise is added to each projected particle, this makes sure that the noise moves along with the fluid flow. 

\subsection{Rendering}
Finally, all intermediate results are merged together in a final texture that is rendered as full-screen quad.
The Fresnel equation is used to calculate the correct reflection and refraction vectors needed for the Phong \cite{phong1975illumination} illumination model.
This results in the following equation \cite{van2009screen}to determine the output color:
\begin{eqnarray}
C_{out} = a(1 - F(\mathbf{n} \cdot \mathbf{v})) + bF(\mathbf{n} \cdot \mathbf{v}) + k_s(\mathbf{n} \cdot \mathbf{h})^\alpha.
\end{eqnarray}
$F$ is the Fresnel equation, $a$ is the refracted fluid color, $b$ is the reflected scene color, $k_s$ and $\alpha$ are both constant and represent the specular highlight. $\mathbf{n}$ is the normal along the surface, $\mathbf{h}$ is the half-angle between the camera and the light, and $\mathbf{v}$ is the direction pointing towards the camera.


\subsection{Fit}