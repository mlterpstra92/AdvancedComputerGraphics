void main(float4 pos : POSITION,
  float density : TEXCOORD0,
  uniform float4x4 modelViewProj,
  uniform float4x4 modelView,
  uniform float2 wsize,
  uniform float near,
  uniform float top,
  uniform float bottom,
  uniform float radius,

  out float4 out_pos : POSITION,
  out float psize : PSIZE
)
{
  if (density < 3)
    discard;

  float4 eye_pos = mul(modelView, pos);
  out_pos = mul(modelViewProj, pos);
  psize = 2.0 * radius * (-near / eye_pos.z) * (wsize.y / (top - bottom));
}